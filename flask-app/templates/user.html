
<html>
	<head>
		<title> MediBot </title>
		<meta charset="UTF-8" name="viewport" content="width=device-width, initial-scale=1.0">
	

		<!--Import Google Icon Font-->
		<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
		<link href="https://fonts.googleapis.com/css?family=Raleway:500&display=swap" rel="stylesheet">
	
		<!--Import Font Awesome Icon Font-->
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
			integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />  
	
		<!--Main css-->
		<link rel="stylesheet" type="text/css" href="/static/css/style.css">
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
		<link href="https://fonts.googleapis.com/css?family=Droid+Sans" rel="stylesheet">
		<link rel="stylesheet" href="/static/css/dash.css">
		<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
		<style>
			* {
        box-sizing: border-box;
        -moz-box-sizing: border-box;
        -webkit-box-sizing: border-box;
    }
    body {
        font-family: Helvetica;
    }
    #chat_container {
        overflow: hidden;
        border-radius: 15px;
        border: 1px solid rgb(255, 255, 255);
		margin: 40px 80px 0px 80px;
		margin-left: 30%;
    }
    #chat_log {
        background-color: #F3F76F;
        padding: 10px;
        border-bottom: 1px solid black;
        overflow-y: scroll;
        height: 50%;
		font-size: 26px;
	
    }
    #chat_input_container {
        padding: 10px;
    }
    #chat_input {
        padding: 2px;
        font-size: 18px;
		width: 100%;

    }
    .chat_line {
        overflow: hidden;
        width: 100%;
        margin: 2px 0 12px 0;
    }
    .chat_triangle, .chat_triangle_user {
        position: absolute;
        top: 0;
        width: 0;
        height: 0;
        border-style: solid;
        left: -18px;
        border-width: 0 18px 13px 0;
        border-color: transparent #ffffff transparent transparent;
    }
    .chat_triangle_user {
        left: auto;
        right: -18px;
        border-width: 13px 18px 0 0;
        border-color: #234b9b transparent transparent transparent;
    }
    .chat_bubble, .chat_bubble_user {
        position: relative;
        float: left;
        background-color: #FFF;
        margin-top: 10px;
        line-height: 35px;
        padding: 10px 25px 10px 25px;
        margin-left: 20px;
        font-size: 27px;
    }
    .chat_bubble_user {
        float: right;
        margin-left: 0px;
        margin-right: 20px;
        background-color: #234b9b;
        color: #FFF;
    }
			#map2 {
			height: 750px;

		}
			#map1 {
			height: 500px;
			margin: 100px auto 50px;
			width: 800px;
			/* position: relative; */
		}
		</style>
		<script>
			// var ws = new WebSocket("ws://localhost:8000");
			// // Close socket when window closes
			// $(window).on('beforeunload', function(){
			//    ws.close();
			// });
			// ws.onerror = function(event) {
			// 	location.reload();
			// }
			// ws.onmessage = function(event)  { 
			// 	var message_received = event.data;
			// 	chat_add_message(message_received, false);
			// };
			// Add a message to the chat history
			function chat_add_message(message, isUser) {
				var class_suffix = isUser ? '_user' : '';
				var html = '\
				<div class="chat_line">\
					<div class="chat_bubble'+class_suffix+'">\
					  <div class="chat_triangle'+class_suffix+'"></div>\
						'+message+'\
					</div>\
				</div>\
				';
				chat_add_html(html);
			}
			// Add HTML to the chat history
			function chat_add_html(html) {
				$("#chat_log").append(html);
				chat_scrolldown();
			}
			// Scrolls the chat history to the bottom
			function chat_scrolldown() {
				$("#chat_log").animate({ scrollTop: $("#chat_log")[0].scrollHeight }, 500);
			}
			// If press ENTER, talk to chat and send message to server
			$(function() {
			   $('#chat_input').on('keypress', function(event) {
				  if (event.which === 13 && $(this).val() != ""){
					 var message = $(this).val();
					 $(this).val("");
					 chat_add_message(message, true);
					 ws.send(message);
				  }
			   });
			});
		</script>
	</head>
	<body>
		<aside class="side-nav  " id="show-side-navigation1">
		<i class="fa fa-bars close-aside hidden-sm hidden-md hidden-lg" data-close="show-side-navigation1"></i>
		<div class="heading">
		  <div class="info">
			<h3><a href="#"> Analytica </a></h3>
			<p>@Medical Heathcare</p>
		  </div>
		</div>
		<div class="search">
		  <input type="text" placeholder="Type here"><i class="fa fa-search"></i>
		</div>
		<ul class="categories">
		  <li><i class="fa fa-home fa-fw" ></i><a href="/home/{{name}}">Home</a></li>
		  <li><i class="fa fa-support fa-fw"></i><a href="#chatbot" onclick="chatbot()"> Chatbot </a></li>
		  <li><i class="fa fa-support fa-fw"></i><a href="/retrain/{{name}}"> Save Stories </a></li>
		  <li><i class="fa fa-support fa-fw"></i><a href="#showmap" onclick="setup()"> Show Map </a></li>
		  <li><i class="fa fa-support fa-fw"></i><a href="#chatbot1" ></a> New Chatbot</a></li>
		  <li><i class="fa fa-support fa-fw"></i><a href="/logout"> Logout</a>
		  </li>
		  
		</ul>
	</aside>

	  <section id="chatbot">
		
		<div id="y2j" class="col-md-4" style="display: none;margin-left: 21%;">
            <div class="box">
				<iframe  width="720" height="480" frameborder="0" id="video" allow="autoplay; fullscreen"></iframe>
            </div>
		</div>
		
		<div id="map1" style="display: none;"></div>

		<p id="username" style="display: none;">{{ name }}</p>


			<!-- chatbot code -->
			<mybot></mybot>
			<!--container end-->
			<!--JS-->

	</section>

	<section id="showmap" style="display:none;">
		<div  id="map2" ></div>
	</section>

	<section id="chatbot1">
		<div id="chat_container">
			<div id="chat_log">
			</div>
			<div id="chat_input_container">
				<div><input id="chat_input" /></div>
			</div>
		</div>
		<!-- <div id="y2j" class="col-md-4" style="display: none;margin-left: 21%;">
            <div class="box">
				<iframe  width="720" height="480" frameborder="0" id="video" allow="autoplay; fullscreen"></iframe>
            </div>
		</div>
		
		<div id="map1" style="display: none;"></div>

		<p id="username" style="display: none;">{{ name }}</p> -->

	</section>


		<!-- Scripts -->
			<script src="/static/js/jquery.min.js"></script>
			<script src="/static/js/jquery.scrolly.min.js"></script>
			<script src="/static/js/skel.min.js"></script>
			<script src="/static/js/util.js"></script>
			<script src="/static/js/main.js"></script>
			<!--JavaScript at end of body for optimized loading-->
			<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.6.0/Chart.bundle.js"></script>
			<script src="/static/js/dash.js"></script>
			<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
			<script src="http://code.jquery.com/jquery-latest.js"></script>
			<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
			<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
			<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

	  
			<!--Main Script -->
			<script type="text/javascript" src="/static/js/rasa.js"></script>
	  
			<!--Chart.js Script -->
			<script type="text/javascript" src="/static/js/chart.min.js"></script>
			<script type="text/javascript" src="/static/js/map.js"></script>
			
			<script>
				
				let chat = document.getElementById("chatbot");
				let other = document.getElementById("showmap");

				function sleep(milliseconds) {
					const date = Date.now();
					let currentDate = null;
					do {
					currentDate = Date.now();
					} while (currentDate - date < milliseconds);
				}
				
				async function startMap(){
					console.log(document.getElementById("gmaps"));
					if (document.getElementById("gmaps") == null){
						console.log("create script tag....");
						let script = document.createElement("script");
						script.src = "https://maps.googleapis.com/maps/api/js?key={{key}}&libraries=places";
						script.defer = true;
						script.async = true;
						script.id = "gmaps";
						document.head.appendChild(script);
						sleep(2000);
						await initMap();
					}
					else{
						console.log("script tag already exists");
						await initMap();
					}

				}
				async function chatbot(){
					other.style.display = "none";
					chat.style.display = "block";
				}
				async function setup(){
					chat.style.display = "none";
					await startMap();
					other.style.display = "block";
				}

			</script>
	</body>
</html>